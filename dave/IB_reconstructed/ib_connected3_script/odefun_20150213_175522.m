function [Y,T] = odefun_20150213_175522
tspan=[0 100]; dt=0.02;
T=tspan(1):dt:tspan(2); nstep=length(T);
fileID = 1; nreports = 5; enableLog = 1:(nstep-1)/nreports:nstep;enableLog(1) = [];
fprintf('\nSimulation interval: %g-%g\n',tspan);fprintf('Starting integration (euler, dt=%g)\n',dt);IBa_IBa_itonic_offset = [Inf];
IBs_IBa_IBs_IBa_iCOM_UB = max((3),(3));
IBs_IBa_IBs_IBa_iCOM_Xpre = linspace(1,IBs_IBa_IBs_IBa_iCOM_UB,(3))'*ones(1,(3));
IBs_IBa_IBs_IBa_iCOM_Xpost = (linspace(1,IBs_IBa_IBs_IBa_iCOM_UB,(3))'*ones(1,(3)))';
IBs_IBa_IBs_IBa_iCOM_mask = abs(IBs_IBa_IBs_IBa_iCOM_Xpre-IBs_IBa_IBs_IBa_iCOM_Xpost)<=(0.5);
IBs_IBs_itonic_offset = [Inf];
IBa_IBs_IBa_IBs_iCOM_UB = max((3),(3));
IBa_IBs_IBa_IBs_iCOM_Xpre = linspace(1,IBa_IBs_IBa_IBs_iCOM_UB,(3))'*ones(1,(3));
IBa_IBs_IBa_IBs_iCOM_Xpost = (linspace(1,IBa_IBs_IBa_IBs_iCOM_UB,(3))'*ones(1,(3)))';
IBa_IBs_IBa_IBs_iCOM_mask = abs(IBa_IBs_IBa_IBs_iCOM_Xpre-IBa_IBs_IBa_IBs_iCOM_Xpost)<=(0.5);
IBda_IBs_IBda_IBs_iCOM_UB = max((3),(3));
IBda_IBs_IBda_IBs_iCOM_Xpre = linspace(1,IBda_IBs_IBda_IBs_iCOM_UB,(3))'*ones(1,(3));
IBda_IBs_IBda_IBs_iCOM_Xpost = (linspace(1,IBda_IBs_IBda_IBs_iCOM_UB,(3))'*ones(1,(3)))';
IBda_IBs_IBda_IBs_iCOM_mask = abs(IBda_IBs_IBda_IBs_iCOM_Xpre-IBda_IBs_IBda_IBs_iCOM_Xpost)<=(0.5);
IBdb_IBs_IBdb_IBs_iCOM_UB = max((3),(3));
IBdb_IBs_IBdb_IBs_iCOM_Xpre = linspace(1,IBdb_IBs_IBdb_IBs_iCOM_UB,(3))'*ones(1,(3));
IBdb_IBs_IBdb_IBs_iCOM_Xpost = (linspace(1,IBdb_IBs_IBdb_IBs_iCOM_UB,(3))'*ones(1,(3)))';
IBdb_IBs_IBdb_IBs_iCOM_mask = abs(IBdb_IBs_IBdb_IBs_iCOM_Xpre-IBdb_IBs_IBdb_IBs_iCOM_Xpost)<=(0.5);
IBda_IBda_itonic_offset = [Inf];
IBs_IBda_IBs_IBda_iCOM_UB = max((3),(3));
IBs_IBda_IBs_IBda_iCOM_Xpre = linspace(1,IBs_IBda_IBs_IBda_iCOM_UB,(3))'*ones(1,(3));
IBs_IBda_IBs_IBda_iCOM_Xpost = (linspace(1,IBs_IBda_IBs_IBda_iCOM_UB,(3))'*ones(1,(3)))';
IBs_IBda_IBs_IBda_iCOM_mask = abs(IBs_IBda_IBs_IBda_iCOM_Xpre-IBs_IBda_IBs_IBda_iCOM_Xpost)<=(0.5);
IBdb_IBdb_itonic_offset = [Inf];
IBdb_IBdb_iPoissonExp_G = getPoissonExp((100),(10),(1),(3),(2000),(0.02),(0),(2));
IBa_IBdb_IBa_IBdb_iSYNconv_Xpre = sorti(randn((3),(3)),1);
IBa_IBdb_IBa_IBdb_iSYNconv_mask = IBa_IBdb_IBa_IBdb_iSYNconv_Xpre <= (20);
IBs_IBdb_IBs_IBdb_iCOM_UB = max((3),(3));
IBs_IBdb_IBs_IBdb_iCOM_Xpre = linspace(1,IBs_IBdb_IBs_IBdb_iCOM_UB,(3))'*ones(1,(3));
IBs_IBdb_IBs_IBdb_iCOM_Xpost = (linspace(1,IBs_IBdb_IBs_IBdb_iCOM_UB,(3))'*ones(1,(3)))';
IBs_IBdb_IBs_IBdb_iCOM_mask = abs(IBs_IBdb_IBs_IBdb_iCOM_Xpre-IBs_IBdb_IBs_IBdb_iCOM_Xpost)<=(0.5);
IBa_IBa_itonic_Itonic = @(t) (6)*(t>(0) & t<IBa_IBa_itonic_offset);
IBa_IBa_iNaF_hinf = @(IBa_V) 1./(1+exp((IBa_V+(59.4))/(10.7)));
IBa_IBa_iNaF_htau = @(IBa_V) (0.15) + (1.15)./(1+exp((IBa_V+(33.5))/(15)));
IBa_IBa_iNaF_m0 = @(IBa_V) 1./(1+exp((-IBa_V-(34.5))/10));
IBa_IBa_iNaF_aH = @(IBa_V) (1./(1+exp((IBa_V+(59.4))/(10.7)))) ./ ((0.15) + (1.15)./(1+exp((IBa_V+(33.5))/(15))));
IBa_IBa_iNaF_bH = @(IBa_V) (1-(1./(1+exp((IBa_V+(59.4))/(10.7)))))./((0.15) + (1.15)./(1+exp((IBa_V+(33.5))/(15))));
IBa_IBa_iNaF_INaF = @(IBa_V,h) (100).*(1./(1+exp((-IBa_V-(34.5))/10))).^3.*h.*(IBa_V-(50));
IBa_IBa_iKDR_minf = @(IBa_V) 1./(1+exp((-IBa_V-(29.5))/(10)));
IBa_IBa_iKDR_mtau = @(IBa_V) .25+4.35*exp(-abs(IBa_V+(10))/(10));
IBa_IBa_iKDR_aM = @(IBa_V) (1./(1+exp((-IBa_V-(29.5))/(10)))) ./ (.25+4.35*exp(-abs(IBa_V+(10))/(10)));
IBa_IBa_iKDR_bM = @(IBa_V) (1-(1./(1+exp((-IBa_V-(29.5))/(10)))))./(.25+4.35*exp(-abs(IBa_V+(10))/(10)));
IBa_IBa_iKDR_IKDR = @(IBa_V,m) (5).*m.^4.*(IBa_V-(-95));
IBa_IBa_iM_aM = @(IBa_V) (1.5).*(.02./(1+exp((-20-IBa_V)/5)));
IBa_IBa_iM_bM = @(IBa_V) (0.75).*(.01*exp((-43-IBa_V)/18));
IBa_IBa_iM_IM = @(IBa_V,m) (1.5).*m.*(IBa_V-(-95));
IBs_IBa_IBs_IBa_iCOM_ICOM = @(V1,V2) (0.3).*sum(((V1*ones(1,size(V1,1)))'-(V2*ones(1,size(V2,1)))).*IBs_IBa_IBs_IBa_iCOM_mask,2);
IBs_IBs_itonic_Itonic = @(t) (4.5)*(t>(0) & t<IBs_IBs_itonic_offset);
IBs_IBs_iNaF_hinf = @(IBs_V) 1./(1+exp((IBs_V+(59.4))/(10.7)));
IBs_IBs_iNaF_htau = @(IBs_V) (0.15) + (1.15)./(1+exp((IBs_V+(33.5))/(15)));
IBs_IBs_iNaF_m0 = @(IBs_V) 1./(1+exp((-IBs_V-(34.5))/10));
IBs_IBs_iNaF_aH = @(IBs_V) (1./(1+exp((IBs_V+(59.4))/(10.7)))) ./ ((0.15) + (1.15)./(1+exp((IBs_V+(33.5))/(15))));
IBs_IBs_iNaF_bH = @(IBs_V) (1-(1./(1+exp((IBs_V+(59.4))/(10.7)))))./((0.15) + (1.15)./(1+exp((IBs_V+(33.5))/(15))));
IBs_IBs_iNaF_INaF = @(IBs_V,h) (50).*(1./(1+exp((-IBs_V-(34.5))/10))).^3.*h.*(IBs_V-(50));
IBs_IBs_iKDR_minf = @(IBs_V) 1./(1+exp((-IBs_V-(29.5))/(10)));
IBs_IBs_iKDR_mtau = @(IBs_V) .25+4.35*exp(-abs(IBs_V+(10))/(10));
IBs_IBs_iKDR_aM = @(IBs_V) (1./(1+exp((-IBs_V-(29.5))/(10)))) ./ (.25+4.35*exp(-abs(IBs_V+(10))/(10)));
IBs_IBs_iKDR_bM = @(IBs_V) (1-(1./(1+exp((-IBs_V-(29.5))/(10)))))./(.25+4.35*exp(-abs(IBs_V+(10))/(10)));
IBs_IBs_iKDR_IKDR = @(IBs_V,m) (10).*m.^4.*(IBs_V-(-95));
IBa_IBs_IBa_IBs_iCOM_ICOM = @(V1,V2) (0.3).*sum(((V1*ones(1,size(V1,1)))'-(V2*ones(1,size(V2,1)))).*IBa_IBs_IBa_IBs_iCOM_mask,2);
IBda_IBs_IBda_IBs_iCOM_ICOM = @(V1,V2) (0.4).*sum(((V1*ones(1,size(V1,1)))'-(V2*ones(1,size(V2,1)))).*IBda_IBs_IBda_IBs_iCOM_mask,2);
IBdb_IBs_IBdb_IBs_iCOM_ICOM = @(V1,V2) (0.4).*sum(((V1*ones(1,size(V1,1)))'-(V2*ones(1,size(V2,1)))).*IBdb_IBs_IBdb_IBs_iCOM_mask,2);
IBda_IBda_itonic_Itonic = @(t) (-23.5)*(t>(0) & t<IBda_IBda_itonic_offset);
IBda_IBda_iNaF_hinf = @(IBda_V) 1./(1+exp((IBda_V+(59.4))/(10.7)));
IBda_IBda_iNaF_htau = @(IBda_V) (0.15) + (1.15)./(1+exp((IBda_V+(33.5))/(15)));
IBda_IBda_iNaF_m0 = @(IBda_V) 1./(1+exp((-IBda_V-(34.5))/10));
IBda_IBda_iNaF_aH = @(IBda_V) (1./(1+exp((IBda_V+(59.4))/(10.7)))) ./ ((0.15) + (1.15)./(1+exp((IBda_V+(33.5))/(15))));
IBda_IBda_iNaF_bH = @(IBda_V) (1-(1./(1+exp((IBda_V+(59.4))/(10.7)))))./((0.15) + (1.15)./(1+exp((IBda_V+(33.5))/(15))));
IBda_IBda_iNaF_INaF = @(IBda_V,h) (125).*(1./(1+exp((-IBda_V-(34.5))/10))).^3.*h.*(IBda_V-(50));
IBda_IBda_iKDR_minf = @(IBda_V) 1./(1+exp((-IBda_V-(29.5))/(10)));
IBda_IBda_iKDR_mtau = @(IBda_V) .25+4.35*exp(-abs(IBda_V+(10))/(10));
IBda_IBda_iKDR_aM = @(IBda_V) (1./(1+exp((-IBda_V-(29.5))/(10)))) ./ (.25+4.35*exp(-abs(IBda_V+(10))/(10)));
IBda_IBda_iKDR_bM = @(IBda_V) (1-(1./(1+exp((-IBda_V-(29.5))/(10)))))./(.25+4.35*exp(-abs(IBda_V+(10))/(10)));
IBda_IBda_iKDR_IKDR = @(IBda_V,m) (10).*m.^4.*(IBda_V-(-95));
IBda_IBda_iAR_minf = @(IBda_V) 1 ./ (1+exp(((-87.5)-IBda_V)/(-5.5)));
IBda_IBda_iAR_mtau = @(IBda_V) 1./((1).*exp(-14.6-.086*IBda_V)+(1).*exp(-1.87+.07*IBda_V));
IBda_IBda_iAR_aM = @(IBda_V) (2.75).*((1 ./ (1+exp(((-87.5)-IBda_V)/(-5.5)))) ./ (1./((1).*exp(-14.6-.086*IBda_V)+(1).*exp(-1.87+.07*IBda_V))));
IBda_IBda_iAR_bM = @(IBda_V) (3).*((1-(1 ./ (1+exp(((-87.5)-IBda_V)/(-5.5)))))./(1./((1).*exp(-14.6-.086*IBda_V)+(1).*exp(-1.87+.07*IBda_V))));
IBda_IBda_iAR_IAR = @(IBda_V,m) (155).*m.*(IBda_V-(-25));
IBda_IBda_iM_aM = @(IBda_V) (1).*(.02./(1+exp((-20-IBda_V)/5)));
IBda_IBda_iM_bM = @(IBda_V) (1).*(.01*exp((-43-IBda_V)/18));
IBda_IBda_iM_IM = @(IBda_V,m) (0.75).*m.*(IBda_V-(-95));
IBda_IBda_iCaH_aM = @(IBda_V) (3).*(1.6./(1+exp(-.072*(IBda_V-5))));
IBda_IBda_iCaH_bM = @(IBda_V) (3).*(.02*(IBda_V+8.9)./(exp((IBda_V+8.9)/5)-1));
IBda_IBda_iCaH_ICaH = @(IBda_V,m) (6.5).*m.^2.*(-125+IBda_V);
IBs_IBda_IBs_IBda_iCOM_ICOM = @(V1,V2) (0.4).*sum(((V1*ones(1,size(V1,1)))'-(V2*ones(1,size(V2,1)))).*IBs_IBda_IBs_IBda_iCOM_mask,2);
IBdb_IBdb_itonic_Itonic = @(t) (-23.5)*(t>(0) & t<IBdb_IBdb_itonic_offset);
IBdb_IBdb_iNaF_hinf = @(IBdb_V) 1./(1+exp((IBdb_V+(59.4))/(10.7)));
IBdb_IBdb_iNaF_htau = @(IBdb_V) (0.15) + (1.15)./(1+exp((IBdb_V+(33.5))/(15)));
IBdb_IBdb_iNaF_m0 = @(IBdb_V) 1./(1+exp((-IBdb_V-(34.5))/10));
IBdb_IBdb_iNaF_aH = @(IBdb_V) (1./(1+exp((IBdb_V+(59.4))/(10.7)))) ./ ((0.15) + (1.15)./(1+exp((IBdb_V+(33.5))/(15))));
IBdb_IBdb_iNaF_bH = @(IBdb_V) (1-(1./(1+exp((IBdb_V+(59.4))/(10.7)))))./((0.15) + (1.15)./(1+exp((IBdb_V+(33.5))/(15))));
IBdb_IBdb_iNaF_INaF = @(IBdb_V,h) (125).*(1./(1+exp((-IBdb_V-(34.5))/10))).^3.*h.*(IBdb_V-(50));
IBdb_IBdb_iKDR_minf = @(IBdb_V) 1./(1+exp((-IBdb_V-(29.5))/(10)));
IBdb_IBdb_iKDR_mtau = @(IBdb_V) .25+4.35*exp(-abs(IBdb_V+(10))/(10));
IBdb_IBdb_iKDR_aM = @(IBdb_V) (1./(1+exp((-IBdb_V-(29.5))/(10)))) ./ (.25+4.35*exp(-abs(IBdb_V+(10))/(10)));
IBdb_IBdb_iKDR_bM = @(IBdb_V) (1-(1./(1+exp((-IBdb_V-(29.5))/(10)))))./(.25+4.35*exp(-abs(IBdb_V+(10))/(10)));
IBdb_IBdb_iKDR_IKDR = @(IBdb_V,m) (10).*m.^4.*(IBdb_V-(-95));
IBdb_IBdb_iAR_minf = @(IBdb_V) 1 ./ (1+exp(((-87.5)-IBdb_V)/(-5.5)));
IBdb_IBdb_iAR_mtau = @(IBdb_V) 1./((1).*exp(-14.6-.086*IBdb_V)+(1).*exp(-1.87+.07*IBdb_V));
IBdb_IBdb_iAR_aM = @(IBdb_V) (2.75).*((1 ./ (1+exp(((-87.5)-IBdb_V)/(-5.5)))) ./ (1./((1).*exp(-14.6-.086*IBdb_V)+(1).*exp(-1.87+.07*IBdb_V))));
IBdb_IBdb_iAR_bM = @(IBdb_V) (3).*((1-(1 ./ (1+exp(((-87.5)-IBdb_V)/(-5.5)))))./(1./((1).*exp(-14.6-.086*IBdb_V)+(1).*exp(-1.87+.07*IBdb_V))));
IBdb_IBdb_iAR_IAR = @(IBdb_V,m) (115).*m.*(IBdb_V-(-25));
IBdb_IBdb_iM_aM = @(IBdb_V) (1).*(.02./(1+exp((-20-IBdb_V)/5)));
IBdb_IBdb_iM_bM = @(IBdb_V) (1).*(.01*exp((-43-IBdb_V)/18));
IBdb_IBdb_iM_IM = @(IBdb_V,m) (0.75).*m.*(IBdb_V-(-95));
IBdb_IBdb_iCaH_aM = @(IBdb_V) (3).*(1.6./(1+exp(-.072*(IBdb_V-5))));
IBdb_IBdb_iCaH_bM = @(IBdb_V) (3).*(.02*(IBdb_V+8.9)./(exp((IBdb_V+8.9)/5)-1));
IBdb_IBdb_iCaH_ICaH = @(IBdb_V,m) (6.5).*m.^2.*(-125+IBdb_V);
IBdb_IBdb_iPoissonExp_Gt = @(t) (125).*IBdb_IBdb_iPoissonExp_G(:,max(1,round(t/(0.02))));
IBdb_IBdb_iPoissonExp_Itrain = @(t,IBdb_V) ((125).*IBdb_IBdb_iPoissonExp_G(:,max(1,round(t/(0.02))))).*(IBdb_V-(-80));
IBa_IBdb_IBa_IBdb_iSYNconv_ISYNconv = @(IBdb_V,s) ((0.04).*(s'*IBa_IBdb_IBa_IBdb_iSYNconv_mask)'.*(IBdb_V-(-80)));
IBs_IBdb_IBs_IBdb_iCOM_ICOM = @(V1,V2) (0.4).*sum(((V1*ones(1,size(V1,1)))'-(V2*ones(1,size(V2,1)))).*IBs_IBdb_IBs_IBdb_iCOM_mask,2);
IBa_V = zeros(3,nstep);
IBa_V(:,1) = [0  0  0];
IBa_IBa_iNaF_hNaF = zeros(3,nstep);
IBa_IBa_iNaF_hNaF(:,1) = [0.5         0.5         0.5];
IBa_IBa_iKDR_mKDR = zeros(3,nstep);
IBa_IBa_iKDR_mKDR(:,1) = [0.34        0.34        0.34];
IBa_IBa_iM_mM = zeros(3,nstep);
IBa_IBa_iM_mM(:,1) = [0.05        0.05        0.05];
IBs_V = zeros(3,nstep);
IBs_V(:,1) = [0  0  0];
IBs_IBs_iNaF_hNaF = zeros(3,nstep);
IBs_IBs_iNaF_hNaF(:,1) = [0.5         0.5         0.5];
IBs_IBs_iKDR_mKDR = zeros(3,nstep);
IBs_IBs_iKDR_mKDR(:,1) = [0.34        0.34        0.34];
IBda_V = zeros(3,nstep);
IBda_V(:,1) = [0  0  0];
IBda_IBda_iNaF_hNaF = zeros(3,nstep);
IBda_IBda_iNaF_hNaF(:,1) = [0.5         0.5         0.5];
IBda_IBda_iKDR_mKDR = zeros(3,nstep);
IBda_IBda_iKDR_mKDR(:,1) = [0.34        0.34        0.34];
IBda_IBda_iAR_mAR = zeros(3,nstep);
IBda_IBda_iAR_mAR(:,1) = [0.3         0.3         0.3];
IBda_IBda_iM_mM = zeros(3,nstep);
IBda_IBda_iM_mM(:,1) = [0.05        0.05        0.05];
IBda_IBda_iCaH_mCaH = zeros(3,nstep);
IBda_IBda_iCaH_mCaH(:,1) = [0.2         0.2         0.2];
IBdb_V = zeros(3,nstep);
IBdb_V(:,1) = [0  0  0];
IBdb_IBdb_iNaF_hNaF = zeros(3,nstep);
IBdb_IBdb_iNaF_hNaF(:,1) = [0.5         0.5         0.5];
IBdb_IBdb_iKDR_mKDR = zeros(3,nstep);
IBdb_IBdb_iKDR_mKDR(:,1) = [0.34        0.34        0.34];
IBdb_IBdb_iAR_mAR = zeros(3,nstep);
IBdb_IBdb_iAR_mAR(:,1) = [0.3         0.3         0.3];
IBdb_IBdb_iM_mM = zeros(3,nstep);
IBdb_IBdb_iM_mM(:,1) = [0.05        0.05        0.05];
IBdb_IBdb_iCaH_mCaH = zeros(3,nstep);
IBdb_IBdb_iCaH_mCaH(:,1) = [0.2         0.2         0.2];
IBa_IBdb_IBa_IBdb_iSYNconv_sSYNpre = zeros(3,nstep);
IBa_IBdb_IBa_IBdb_iSYNconv_sSYNpre(:,1) = [0.1         0.1         0.1];
tstart = tic;
for k=2:nstep
  t=T(k-1);
  F=(((((6)*(t>(0) & t<IBa_IBa_itonic_offset)))+(((0).*randn((3),1))+((-((100).*(1./(1+exp((-IBa_V(:,k-1)-(34.5))/10))).^3.*IBa_IBa_iNaF_hNaF(:,k-1).*(IBa_V(:,k-1)-(50))))+((-((5).*IBa_IBa_iKDR_mKDR(:,k-1).^4.*(IBa_V(:,k-1)-(-95))))+((-((1.5).*IBa_IBa_iM_mM(:,k-1).*(IBa_V(:,k-1)-(-95))))+((-((0.3).*sum(((IBa_V(:,k-1)*ones(1,size(IBa_V(:,k-1),1)))'-(IBs_V(:,k-1)*ones(1,size(IBs_V(:,k-1),1)))).*IBs_IBa_IBs_IBa_iCOM_mask,2)))+0)))))))/(0.9);
  IBa_V(:,k) = IBa_V(:,k-1) + dt*F;
  F=((1./(1+exp((IBa_V(:,k-1)+(59.4))/(10.7)))) ./ ((0.15) + (1.15)./(1+exp((IBa_V(:,k-1)+(33.5))/(15))))).*(1-IBa_IBa_iNaF_hNaF(:,k-1))-((1-(1./(1+exp((IBa_V(:,k-1)+(59.4))/(10.7)))))./((0.15) + (1.15)./(1+exp((IBa_V(:,k-1)+(33.5))/(15))))).*IBa_IBa_iNaF_hNaF(:,k-1);
  IBa_IBa_iNaF_hNaF(:,k) = IBa_IBa_iNaF_hNaF(:,k-1) + dt*F;
  F=((1./(1+exp((-IBa_V(:,k-1)-(29.5))/(10)))) ./ (.25+4.35*exp(-abs(IBa_V(:,k-1)+(10))/(10)))).*(1-IBa_IBa_iKDR_mKDR(:,k-1))-((1-(1./(1+exp((-IBa_V(:,k-1)-(29.5))/(10)))))./(.25+4.35*exp(-abs(IBa_V(:,k-1)+(10))/(10)))).*IBa_IBa_iKDR_mKDR(:,k-1);
  IBa_IBa_iKDR_mKDR(:,k) = IBa_IBa_iKDR_mKDR(:,k-1) + dt*F;
  F=(((1.5).*(.02./(1+exp((-20-IBa_V(:,k-1))/5)))).*(1-IBa_IBa_iM_mM(:,k-1))-((0.75).*(.01*exp((-43-IBa_V(:,k-1))/18))).*IBa_IBa_iM_mM(:,k-1));
  IBa_IBa_iM_mM(:,k) = IBa_IBa_iM_mM(:,k-1) + dt*F;
  F=(((((4.5)*(t>(0) & t<IBs_IBs_itonic_offset)))+(((0).*randn((3),1))+((-((50).*(1./(1+exp((-IBs_V(:,k-1)-(34.5))/10))).^3.*IBs_IBs_iNaF_hNaF(:,k-1).*(IBs_V(:,k-1)-(50))))+((-((10).*IBs_IBs_iKDR_mKDR(:,k-1).^4.*(IBs_V(:,k-1)-(-95))))+((-((0.3).*sum(((IBs_V(:,k-1)*ones(1,size(IBs_V(:,k-1),1)))'-(IBa_V(:,k-1)*ones(1,size(IBa_V(:,k-1),1)))).*IBa_IBs_IBa_IBs_iCOM_mask,2)))+((-((0.4).*sum(((IBs_V(:,k-1)*ones(1,size(IBs_V(:,k-1),1)))'-(IBda_V(:,k-1)*ones(1,size(IBda_V(:,k-1),1)))).*IBda_IBs_IBda_IBs_iCOM_mask,2)))+((-((0.4).*sum(((IBs_V(:,k-1)*ones(1,size(IBs_V(:,k-1),1)))'-(IBdb_V(:,k-1)*ones(1,size(IBdb_V(:,k-1),1)))).*IBdb_IBs_IBdb_IBs_iCOM_mask,2)))+0))))))));
  IBs_V(:,k) = IBs_V(:,k-1) + dt*F;
  F=((1./(1+exp((IBs_V(:,k-1)+(59.4))/(10.7)))) ./ ((0.15) + (1.15)./(1+exp((IBs_V(:,k-1)+(33.5))/(15))))).*(1-IBs_IBs_iNaF_hNaF(:,k-1))-((1-(1./(1+exp((IBs_V(:,k-1)+(59.4))/(10.7)))))./((0.15) + (1.15)./(1+exp((IBs_V(:,k-1)+(33.5))/(15))))).*IBs_IBs_iNaF_hNaF(:,k-1);
  IBs_IBs_iNaF_hNaF(:,k) = IBs_IBs_iNaF_hNaF(:,k-1) + dt*F;
  F=((1./(1+exp((-IBs_V(:,k-1)-(29.5))/(10)))) ./ (.25+4.35*exp(-abs(IBs_V(:,k-1)+(10))/(10)))).*(1-IBs_IBs_iKDR_mKDR(:,k-1))-((1-(1./(1+exp((-IBs_V(:,k-1)-(29.5))/(10)))))./(.25+4.35*exp(-abs(IBs_V(:,k-1)+(10))/(10)))).*IBs_IBs_iKDR_mKDR(:,k-1);
  IBs_IBs_iKDR_mKDR(:,k) = IBs_IBs_iKDR_mKDR(:,k-1) + dt*F;
  F=(((((-23.5)*(t>(0) & t<IBda_IBda_itonic_offset)))+(((0).*randn((3),1))+((-((125).*(1./(1+exp((-IBda_V(:,k-1)-(34.5))/10))).^3.*IBda_IBda_iNaF_hNaF(:,k-1).*(IBda_V(:,k-1)-(50))))+((-((10).*IBda_IBda_iKDR_mKDR(:,k-1).^4.*(IBda_V(:,k-1)-(-95))))+((-((155).*IBda_IBda_iAR_mAR(:,k-1).*(IBda_V(:,k-1)-(-25))))+((-((0.75).*IBda_IBda_iM_mM(:,k-1).*(IBda_V(:,k-1)-(-95))))+((-((6.5).*IBda_IBda_iCaH_mCaH(:,k-1).^2.*(-125+IBda_V(:,k-1))))+((-((0.4).*sum(((IBda_V(:,k-1)*ones(1,size(IBda_V(:,k-1),1)))'-(IBs_V(:,k-1)*ones(1,size(IBs_V(:,k-1),1)))).*IBs_IBda_IBs_IBda_iCOM_mask,2)))+0)))))))));
  IBda_V(:,k) = IBda_V(:,k-1) + dt*F;
  F=((1./(1+exp((IBda_V(:,k-1)+(59.4))/(10.7)))) ./ ((0.15) + (1.15)./(1+exp((IBda_V(:,k-1)+(33.5))/(15))))).*(1-IBda_IBda_iNaF_hNaF(:,k-1))-((1-(1./(1+exp((IBda_V(:,k-1)+(59.4))/(10.7)))))./((0.15) + (1.15)./(1+exp((IBda_V(:,k-1)+(33.5))/(15))))).*IBda_IBda_iNaF_hNaF(:,k-1);
  IBda_IBda_iNaF_hNaF(:,k) = IBda_IBda_iNaF_hNaF(:,k-1) + dt*F;
  F=((1./(1+exp((-IBda_V(:,k-1)-(29.5))/(10)))) ./ (.25+4.35*exp(-abs(IBda_V(:,k-1)+(10))/(10)))).*(1-IBda_IBda_iKDR_mKDR(:,k-1))-((1-(1./(1+exp((-IBda_V(:,k-1)-(29.5))/(10)))))./(.25+4.35*exp(-abs(IBda_V(:,k-1)+(10))/(10)))).*IBda_IBda_iKDR_mKDR(:,k-1);
  IBda_IBda_iKDR_mKDR(:,k) = IBda_IBda_iKDR_mKDR(:,k-1) + dt*F;
  F=((2.75).*((1 ./ (1+exp(((-87.5)-IBda_V(:,k-1))/(-5.5)))) ./ (1./((1).*exp(-14.6-.086*IBda_V(:,k-1))+(1).*exp(-1.87+.07*IBda_V(:,k-1)))))).*(1-IBda_IBda_iAR_mAR(:,k-1))-((3).*((1-(1 ./ (1+exp(((-87.5)-IBda_V(:,k-1))/(-5.5)))))./(1./((1).*exp(-14.6-.086*IBda_V(:,k-1))+(1).*exp(-1.87+.07*IBda_V(:,k-1)))))).*IBda_IBda_iAR_mAR(:,k-1);
  IBda_IBda_iAR_mAR(:,k) = IBda_IBda_iAR_mAR(:,k-1) + dt*F;
  F=(((1).*(.02./(1+exp((-20-IBda_V(:,k-1))/5)))).*(1-IBda_IBda_iM_mM(:,k-1))-((1).*(.01*exp((-43-IBda_V(:,k-1))/18))).*IBda_IBda_iM_mM(:,k-1));
  IBda_IBda_iM_mM(:,k) = IBda_IBda_iM_mM(:,k-1) + dt*F;
  F=(((3).*(1.6./(1+exp(-.072*(IBda_V(:,k-1)-5))))).*(1-IBda_IBda_iCaH_mCaH(:,k-1))-((3).*(.02*(IBda_V(:,k-1)+8.9)./(exp((IBda_V(:,k-1)+8.9)/5)-1))).*IBda_IBda_iCaH_mCaH(:,k-1))/(0.33333);
  IBda_IBda_iCaH_mCaH(:,k) = IBda_IBda_iCaH_mCaH(:,k-1) + dt*F;
  F=(((((-23.5)*(t>(0) & t<IBdb_IBdb_itonic_offset)))+(((0).*randn((3),1))+((-((125).*(1./(1+exp((-IBdb_V(:,k-1)-(34.5))/10))).^3.*IBdb_IBdb_iNaF_hNaF(:,k-1).*(IBdb_V(:,k-1)-(50))))+((-((10).*IBdb_IBdb_iKDR_mKDR(:,k-1).^4.*(IBdb_V(:,k-1)-(-95))))+((-((115).*IBdb_IBdb_iAR_mAR(:,k-1).*(IBdb_V(:,k-1)-(-25))))+((-((0.75).*IBdb_IBdb_iM_mM(:,k-1).*(IBdb_V(:,k-1)-(-95))))+((-((6.5).*IBdb_IBdb_iCaH_mCaH(:,k-1).^2.*(-125+IBdb_V(:,k-1))))+((-(((125).*IBdb_IBdb_iPoissonExp_G(:,max(1,round(t/(0.02))))).*(IBdb_V(:,k-1)-(-80))))+((-(((0.04).*(IBa_IBdb_IBa_IBdb_iSYNconv_sSYNpre(:,k-1)'*IBa_IBdb_IBa_IBdb_iSYNconv_mask)'.*(IBdb_V(:,k-1)-(-80)))))+((-((0.4).*sum(((IBdb_V(:,k-1)*ones(1,size(IBdb_V(:,k-1),1)))'-(IBs_V(:,k-1)*ones(1,size(IBs_V(:,k-1),1)))).*IBs_IBdb_IBs_IBdb_iCOM_mask,2)))+0)))))))))));
  IBdb_V(:,k) = IBdb_V(:,k-1) + dt*F;
  F=((1./(1+exp((IBdb_V(:,k-1)+(59.4))/(10.7)))) ./ ((0.15) + (1.15)./(1+exp((IBdb_V(:,k-1)+(33.5))/(15))))).*(1-IBdb_IBdb_iNaF_hNaF(:,k-1))-((1-(1./(1+exp((IBdb_V(:,k-1)+(59.4))/(10.7)))))./((0.15) + (1.15)./(1+exp((IBdb_V(:,k-1)+(33.5))/(15))))).*IBdb_IBdb_iNaF_hNaF(:,k-1);
  IBdb_IBdb_iNaF_hNaF(:,k) = IBdb_IBdb_iNaF_hNaF(:,k-1) + dt*F;
  F=((1./(1+exp((-IBdb_V(:,k-1)-(29.5))/(10)))) ./ (.25+4.35*exp(-abs(IBdb_V(:,k-1)+(10))/(10)))).*(1-IBdb_IBdb_iKDR_mKDR(:,k-1))-((1-(1./(1+exp((-IBdb_V(:,k-1)-(29.5))/(10)))))./(.25+4.35*exp(-abs(IBdb_V(:,k-1)+(10))/(10)))).*IBdb_IBdb_iKDR_mKDR(:,k-1);
  IBdb_IBdb_iKDR_mKDR(:,k) = IBdb_IBdb_iKDR_mKDR(:,k-1) + dt*F;
  F=((2.75).*((1 ./ (1+exp(((-87.5)-IBdb_V(:,k-1))/(-5.5)))) ./ (1./((1).*exp(-14.6-.086*IBdb_V(:,k-1))+(1).*exp(-1.87+.07*IBdb_V(:,k-1)))))).*(1-IBdb_IBdb_iAR_mAR(:,k-1))-((3).*((1-(1 ./ (1+exp(((-87.5)-IBdb_V(:,k-1))/(-5.5)))))./(1./((1).*exp(-14.6-.086*IBdb_V(:,k-1))+(1).*exp(-1.87+.07*IBdb_V(:,k-1)))))).*IBdb_IBdb_iAR_mAR(:,k-1);
  IBdb_IBdb_iAR_mAR(:,k) = IBdb_IBdb_iAR_mAR(:,k-1) + dt*F;
  F=(((1).*(.02./(1+exp((-20-IBdb_V(:,k-1))/5)))).*(1-IBdb_IBdb_iM_mM(:,k-1))-((1).*(.01*exp((-43-IBdb_V(:,k-1))/18))).*IBdb_IBdb_iM_mM(:,k-1));
  IBdb_IBdb_iM_mM(:,k) = IBdb_IBdb_iM_mM(:,k-1) + dt*F;
  F=(((3).*(1.6./(1+exp(-.072*(IBdb_V(:,k-1)-5))))).*(1-IBdb_IBdb_iCaH_mCaH(:,k-1))-((3).*(.02*(IBdb_V(:,k-1)+8.9)./(exp((IBdb_V(:,k-1)+8.9)/5)-1))).*IBdb_IBdb_iCaH_mCaH(:,k-1))/(0.33333);
  IBdb_IBdb_iCaH_mCaH(:,k) = IBdb_IBdb_iCaH_mCaH(:,k-1) + dt*F;
  F=-IBa_IBdb_IBa_IBdb_iSYNconv_sSYNpre(:,k-1)./(100) + ((1-IBa_IBdb_IBa_IBdb_iSYNconv_sSYNpre(:,k-1))/(0.5)).*(1+tanh(IBa_V(:,k-1)/10));;
  IBa_IBdb_IBa_IBdb_iSYNconv_sSYNpre(:,k) = IBa_IBdb_IBa_IBdb_iSYNconv_sSYNpre(:,k-1) + dt*F;
  if any(k == enableLog)
    elapsedTime = toc(tstart);
    elapsedTimeMinutes = floor(elapsedTime/60);
    elapsedTimeSeconds = rem(elapsedTime,60);
    if elapsedTimeMinutes
        fprintf(fileID,'Processed %g of %g ms (elapsed time: %g m %.3f s)\n',T(k),T(end),elapsedTimeMinutes,elapsedTimeSeconds);
    else
        fprintf(fileID,'Processed %g of %g ms (elapsed time: %.3f s)\n',T(k),T(end),elapsedTimeSeconds);
    end
  end
end
Y=cat(1,IBa_V,IBa_IBa_iNaF_hNaF,IBa_IBa_iKDR_mKDR,IBa_IBa_iM_mM,IBs_V,IBs_IBs_iNaF_hNaF,IBs_IBs_iKDR_mKDR,IBda_V,IBda_IBda_iNaF_hNaF,IBda_IBda_iKDR_mKDR,IBda_IBda_iAR_mAR,IBda_IBda_iM_mM,IBda_IBda_iCaH_mCaH,IBdb_V,IBdb_IBdb_iNaF_hNaF,IBdb_IBdb_iKDR_mKDR,IBdb_IBdb_iAR_mAR,IBdb_IBdb_iM_mM,IBdb_IBdb_iCaH_mCaH,IBa_IBdb_IBa_IBdb_iSYNconv_sSYNpre)';
